/*!
  CSVPARSER.js is based on node-csv-parser, but ported for the browser and
  added functionality, like commented lines and transformBefore option.
  Original module see here: https://github.com/wdavidw/node-csv-parser
  
  License for node-csv-parser:
  BSD License. Copyright (c) 2008-2010, SARL Adaltas. All rights reserved.
  
  
  Modifications for csvparser.js
  BSD License. Copyright (c) 2011, jens alexander ewald. All rights reserved.
  
!*/
(function(){(function(a){var b,c;return typeof Array.isArray!="function"&&(Array.
isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"})
,Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b,c;b=0,c=this
.length;while(b<c){if(this[b]===a)return b;b++}return-1}),a.EventEmitter=function(
){function a(){}return a}(),b=a.EventEmitter,c=Array.isArray,b.prototype.emit=function(
a){var b,d,e,f,g;if(a==="error")if(!this._events||!this._events.error||c(this._events
.error)&&!this._events.error.length)throw arguments[1]instanceof Error?arguments[1
]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;d=this
._events[a];if(!d)return!1;if(typeof d=="function"){switch(arguments.length){case 1
:d.call(this);break;case 2:d.call(this,arguments[1]);break;case 3:d.call(this,arguments
[1],arguments[2]);break;default:b=Array.prototype.slice.call(arguments,1),d.apply
(this,b)}return!0}if(c(d)){b=Array.prototype.slice.call(arguments,1),g=d.slice(),
e=0,f=g.length;while(e<f)g[e].apply(this,b),e++;return!0}return!1},b.prototype.addListener=
function(a,b){if("function"!=typeof b)throw new Error("addListener only takes instances of Function"
);return this._events||(this._events={}),this.emit("newListener",a,b),this._events
[a]?c(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b
]:this._events[a]=b,this},b.prototype.on_=b.prototype.addListener,b.prototype.on=
b.prototype.addListener,b.prototype.once=function(a,b){var c,d;return d=this,d.on_
(a,c=function(){return d.removeListener(a,c),b.apply(this,arguments)})},b.prototype
.removeListener=function(a,b){var d,e;if("function"!=typeof b)throw new Error("removeListener only takes instances of Function"
);if(!this._events||!this._events[a])return this;e=this._events[a];if(c(e)){d=e.indexOf
(b);if(d<0)return this;e.splice(d,1),e.length===0&&delete this._events[a]}else this
._events[a]===b&&delete this._events[a];return this},b.prototype.removeAllListeners=
function(a){return a&&this._events&&this._events[a]&&(this._events[a]=null),this}
,b.prototype.listeners=function(a){return this._events||(this._events={}),this._events
[a]||(this._events[a]=[]),c(this._events[a])||(this._events[a]=[this._events[a]])
,this._events[a]}})(typeof exports=="undefined"?window:exports)}).call(this),function(
){var a,b,c=Object.prototype.hasOwnProperty,d=function(a,b){function e(){this.constructor=
a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new 
e,a.__super__=b.prototype,a};a=a!=null?a:window;if(typeof b=="undefined"||b===null
)b=function(a,b){var c,d;d=a||{};for(c in b)d[c]=b[c];return d};String.prototype.
trimRight==null&&(String.prototype.trimRight=function(){return this.replace(/\s+$/i
,"")}),a.csv=function(){var a,c,e,f,g,h,i,j;return f=function(){return{transformBefore
:!1,offset:0,count:0,countWriten:0,field:"",line:[],lastC:"",quoted:!1,commented:!1
,buffer:null,bufferPosition:0}},h=f(),i=!1,a=function(){function a(){this.readOptions=
{transformBefore:!1,offset:0,delimiter:",",quote:'"',escape:'"',columns:null,flags
:"r",encoding:"utf8",bufferSize:8388608,trim:!1,ltrim:!1,rtrim:!1},this.writeOptions=
{delimiter:null,quote:null,escape:null,lineBreaks:null,flags:"w",encoding:"utf8",
bufferSize:null,end:!0}}return d(a,EventEmitter),a.prototype.readOptions={},a.prototype
.writeOptions={},a.prototype.from=function(a,d){var f;return d&&b(c.readOptions,d
),f=this,setTimeout(function(){var b,d,i;if(a instanceof Array){c.writeOptions.lineBreaks===
null&&(c.writeOptions.lineBreaks="\r\n");for(d=0,i=a.length;d<i;d++)b=a[d],h.line=
b,e()}else try{g(a)}catch(j){f.emit("error",j);return}return f.end()},1),this},a.
prototype.fromStream=function(a,b){return console.error("fromStream NOT YET IMPLEMENTED!"
)},a.prototype.fromPath=function(a,b){return console.error("fromPath NOT YET IMPLEMENTED!"
)},a.prototype.write=function(a,b){if(typeof a=="string"&&!b)return g(a);j(a,b);if(!
i&&!b)return h.count++},a.prototype.end=function(){if(h.quoted)return c.emit("error"
,new Error("Quoted field not terminated"));if(h.field){if(c.readOptions.trim||c.readOptions
.rtrim)h.field=h.field.trimRight();h.line.push(h.field),h.field=""}return h.line.
length>0&&e(),c.writeStream?(h.bufferPosition!==0&&c.writeStream.write(h.buffer.slice
(0,h.bufferPosition)),this.writeOptions.end?c.writeStream.end():c.emit("end",c.getCount
())):c.emit("end",c.getCount())},a.prototype.getCount=function(){return h.count-(
c.readOptions.offset!=null?c.readOptions.offset:0)},a.prototype.toStream=function(
a,b){return console.error("toStream NOT YET IMPLEMENTED!")},a.prototype.transform=
function(a){return this.transformer=a,this},a}(),c=new a,j=function(a,b){var d,e,
f,g,i,j,k,l,m,n,o;if(typeof a=="undefined"||a===null)return;b||c.emit("data",a,h.
count);if(typeof a=="object"){if(!(a instanceof Array)){e=c.writeOptions.columns||
c.readOptions.columns,o=[];if(e)for(k=0,m=e.length;k<m;k++)d=e[k],o[k]=typeof a[d
]=="undefined"||a[d]===null?"":a[d];else for(d in a)o.push(a[d]);a=o,o=null}if(a instanceof 
Array){l=h.countWriten?c.writeOptions.lineBreaks||"\r":"";for(k=0,n=a.length;k<n;
k++){j=a[k],typeof j!="string"&&(typeof j=="number"?j=""+j:j instanceof Date&&(j=""+
j.getTime()));if(j){i=j.indexOf(c.writeOptions.delimiter||c.readOptions.delimiter
)>=0,g=j.indexOf(c.writeOptions.quote||c.readOptions.quote)>=0,f=j.indexOf("\r")>=0||
j.indexOf("\n")>=0,g&&(j=j.replace(new RegExp(c.writeOptions.quote||c.readOptions
.quote,"g"),(c.writeOptions.escape||c.readOptions.escape)+(c.writeOptions.quote||
c.readOptions.quote)));if(g||i||f)j=(c.writeOptions.quote||c.readOptions.quote)+j+
(c.writeOptions.quote||c.readOptions.quote);l+=j}k!==a.length-1&&(l+=c.writeOptions
.delimiter||c.readOptions.delimiter)}a=l}}if(!b)return h.countWriten++},g=function(
a){var b,d,g,i,j,k;h=f(),a=""+a,k=[];for(d=0,j=a.length;d<j;d++){b=a[d],h.commented||
(h.commented=b==="#");switch(b){case c.readOptions.escape:case c.readOptions.quote
:if(h.commented)break;g=!1;if(b===c.readOptions.escape){i=a.charAt(d+1);if(c.readOptions
.escape===c.readOptions.quote||!!h.field||!!h.quoted||c.readOptions.escape!==i&&i!==
c.readOptions.quoted)d++,g=!0,b=a.charAt(d),h.field+=b}if(!g&&b===c.readOptions.quote
){if(h.field&&!h.quoted){h.field+=b;break}h.quoted?(i=a.charAt(d+1),i&&i!=="\r"&&
i!=="\n"&&i!==c.readOptions.delimiter&&console.error('Invalid closing quote; found "'+
i+'" instead of delimiter "'+c.readOptions.delimiter+'"'),h.quoted=!1):h.field===""&&
(h.quoted=!0)}break;case c.readOptions.delimiter:if(h.commented)break;if(h.quoted
)h.field+=b;else{if(c.readOptions.trim||c.readOptions.rtrim)h.field=h.field.trimRight
();h.line.push(h.field),h.field=""}break;case"\n":case"\r":if(b==="\n"){if(h.quoted
){h.field+=b;break}if(!c.readOptions.quoted&&h.lastC==="\r")break}if(b==="\r"||a.
charAt(d+1!=="\r")){if(h.quoted){h.field+=b;break}c.writeOptions.lineBreaks==null&&
(c.writeOptions.lineBreaks=b+(b==="\r"&&a.charAt(d+1)==="\n"?"\n":""));if(c.readOptions
.trim||c.readOptions.rtrim)h.field=h.field.trimRight();h.line.push(h.field),h.field=""
,e()}break;case" ":if(h.commented)break;if(h.quoted||!c.readOptions.trim&&!c.readOptions
.ltrim||h.field)h.field+=b;break;default:if(h.commented)break;h.field+=b}c.emit("pct"
,d/(a.length-1)),k.push(h.lastC=b)}return k},e=function(){var a,b,d,e,f,g,k;b=h.line
.join("").trim()==="";if(c.readOptions.offset>h.count||h.commented||b){!h.commented&&!
b&&h.count++,h.line=[],h.lastC="",h.commented=!1;return}if(c.readOptions.columns&&
h.count===0&&c.readOptions.columns===!0){c.readOptions.columns=h.line,h.line=[],h
.lastC="";return}c.transformer&&c.readOptions.transformBefore&&(i=!0,h.line=c.transformer
(h.line,h.count),i=!1);if(c.readOptions.columns){e={},g=c.readOptions.columns;for(
d=0,f=g.length;d<f;d++)a=g[d],e[a]=(k=h.line[d])!=null?k:null;h.line=e,e=null}return c
.transformer&&!c.readOptions.transformBefore&&(i=!0,h.line=c.transformer(h.line,h
.count),i=!1),j(h.line),c.emit("progress",h.line,c.getCount()),h.count++,h.line=[
],h.lastC="",h.commented=!1},c}}.call(this);
